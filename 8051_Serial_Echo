ORG 0000H
MAIN:
    MOV TMOD, #20H
    MOV TH1, #-3
    MOV SCON, #50H
    SETB TR1

ECHO_BACK_LOOP:
    ACALL RECEIVE_CHAR
    ACALL SEND_CHAR
    SJMP ECHO_BACK_LOOP

RECEIVE_CHAR:
WAIT_FOR_RECEIVE:
    JNB RI, WAIT_FOR_RECEIVE
    MOV A, SBUF
    CLR RI
    RET

SEND_CHAR:
    MOV SBUF, A
WAIT_FOR_TRANSMIT:
    JNB TI, WAIT_FOR_TRANSMIT
    CLR TI
    RET

END
